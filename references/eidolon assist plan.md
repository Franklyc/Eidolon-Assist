我要做一个用groq的whisper api进行麦克风转录，然后发送给openai的python api兼容接口，并将LLM的回复用免费的TTS（如edge tts）进行播放的程序，具备截图上传功能，按下ctrl+[启动录音，ctrl+]结束录音并且启动工作流程（转录+转录结果发送获取回复+tts播放），ctrl+p全屏截图，ctrl+\删除最后一张截图。且具备一个pyqt6实现的精美现代的采用圆角、渐变、毛玻璃效果的ui。目标是完成一个具备图像和声音感知能力的个人助手。

以下是详细的方案考虑：
**1. 用户体验 (UX) 和 界面 (UI):**

*   **状态指示:**
    *   明确的视觉反馈：录音时（例如，麦克风图标闪烁或变色），处理时（例如，加载动画或状态文本），TTS播放时（例如，声音波纹或播放/停止按钮）。
    *   截图成功/删除成功的短暂提示。
*   **截图预览/管理:**
    *   在发送给LLM之前，最好能预览当前已截取的图片（例如，缩略图列表）。
    *   允许用户点击缩略图查看大图或删除*指定*的截图，而不仅仅是最后一张。Ctrl+\ 删除最后一张很方便，但有时可能需要删除中间的某张。
*   **配置界面:**
    *   API密钥管理：安全地输入和存储Groq、OpenAI兼容接口的API Key和Base URL。
    *   模型选择：允许用户选择不同的Whisper模型（如果Groq API支持），以及不同的LLM模型（如果兼容接口支持）。
    *   TTS语音选择：如果Edge TTS或其他免费TTS库支持多种语音或语速、音调调整，提供选项。
    *   热键自定义：允许用户更改默认的Ctrl+[, Ctrl+], Ctrl+P, Ctrl+\ 快捷键。
    *   麦克风选择：如果用户有多个麦克风，应允许选择使用哪个。
*   **对话历史:**
    *   考虑是否需要一个简单的对话历史记录窗口，显示之前的转录文本、截图（缩略图）、LLM回复。
    *   提供清除历史记录的功能。
*   **错误处理与提示:**
    *   当API调用失败（网络问题、无效Key、额度用尽等）、录音设备未找到、截图失败时，给出清晰的用户提示，而不是程序崩溃。
    *   转录为空或质量很差时的处理逻辑（是直接发送空内容还是提示用户？）。
*   **UI美化细节:**
    *   除了圆角、渐变、毛玻璃，考虑一致的图标、字体、颜色方案和流畅的过渡动画。
    *   响应式布局：虽然是桌面应用，但考虑不同屏幕分辨率下的表现。

**2. 功能增强:**

*   **上下文管理:**
    *   思考如何让LLM理解多轮对话的上下文。简单的方式是每次发送包含最近几轮对话的内容（需要注意Token限制）。让用户定义可以保存多少轮对话，默认是10轮，设置为-1就是保存全部对话历史
*   **停止功能:**
    *   添加一个全局热键（例如 `Ctrl+Esc` 或其他）或者UI按钮，用于紧急停止当前的录音、处理或TTS播放。特别是当TTS播放很长或不想要的内容时。
*   **文本输入:**
    *   除了语音输入，增加一个文本输入框，允许用户直接输入文字与LLM交互。
*   **可配置的系统提示 (System Prompt):**
    *   允许用户自定义发送给LLM的系统提示，以设定AI的角色、语气或行为准则（例如，“你是一个乐于助人的助手”，“请简洁回答”）。
*   **支持更多TTS引擎:**
    *   虽然Edge TTS免费且效果不错，但可以设计成可插拔的结构，方便未来添加或切换到其他TTS服务（如 `pyttsx3` 本地库，或其他在线服务）。

**3. 技术实现:**

*   **异步处理:** 录音、API调用（转录、LLM、TTS）、UI更新都应该是异步的，避免长时间操作阻塞UI线程，导致界面卡顿或无响应。Python的 `asyncio` 和 PyQt 的信号槽机制可以很好地结合。
*   **依赖管理:** 使用 `requirements.txt` 或 `pyproject.toml` (配合 `poetry` 或 `pdm`) 来管理项目依赖。
*   **日志记录:** 添加适当的日志记录，方便调试问题。

**4. 安全与隐私:**

*   **API密钥安全:** 不要在代码中硬编码API密钥。使用配置文件、环境变量或安全的密钥管理方式。
*   **本地数据:** 考虑用户配置、历史记录等本地数据的存储位置和安全性。